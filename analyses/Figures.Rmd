---
title: "Figures"
output: html_document
date: "2023-02-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggpubr)
library(FactoMineR)
library(factoextra)
source("../R/publication_theme.R")
```

# Read in processed datasets
```{r read in processed datasets}
cover <- read_csv("../data/cover.csv")
data_section_summarised <- read_csv("../data/data_section_summarised")
data_section_combined <- read_csv("../data/data_section_combined")
nitrogen <- read_csv("../data/nitrogen.csv")
nitrogen_summarised <- read_csv("../data/nitrogen_summarised")
phosphorous_summarised <- read_csv("../data/phosphorous_summarised")
phosphorous <- read_csv("../data/phosphorous.csv")
root_data <- read_csv("../data/root_data")
data_combined <- read_csv("../data/data_combined")
```

```{r plot mycorrrhizal sample data}
# general model
data_section_cleaned <- na.omit(data_section_combined)
data_section_cleaned$species <- as.character(data_section_cleaned$species)

model <- lm(mean_colonisation ~ fire_frequency.x + RTD + average_diameter_mm + SRL + soil_inorganic_nitrogen + mean.soil_phosphate + species, data = data_section_cleaned)
summary(model)
anova(model)

# plot for just poa pratensis semi-summarised
data_section_poa <- filter(data_section_summarised, species == "Poa pratensis")
fit_poa <- lm(mean_colonisation ~ fire_frequency, data = data_section_poa)
p1_poa <- ggplot(data_section_poa, aes(x=fire_frequency, y=mean_colonisation)) + 
  geom_point() + 
  stat_smooth(method = "lm") + 
  geom_label(aes(x = 0.1, y = 60), hjust = 0, 
             label = paste("Adj R2 = ",signif(summary(fit_poa)$adj.r.squared, 5), 
                           "\nIntercept =",signif(fit_poa$coef[[1]],5 ), 
                           " \nSlope =",signif(fit_poa$coef[[2]], 5), 
                           " \nP =",signif(summary(fit_poa)$coef[2, 4], 5))) +
  ylab("Average mycorrhizal colonisation (% of root)") +
  xlab("Fire frequency (Average Number of Fires / Year") + theme_pubclean() + scale_colour_Publication()
print(p1_poa)

# plot for just Amphicarpa bracteata semi-summarised
data_section_amph <- filter(data_section_summarised)
fit_amph <- lm(mean_colonisation ~ fire_frequency, data = data_section_amph)
p1_amph <- ggplot(data_section_amph, aes(x=fire_frequency, y=mean_colonisation)) + 
  geom_point() + 
  stat_smooth(method = "lm") + 
  geom_label(aes(x = 0.1, y = 75), hjust = 0, 
             label = paste("Adj R2 = ",signif(summary(fit_amph)$adj.r.squared, 5), 
                           "\nIntercept =",signif(fit_amph$coef[[1]],5 ), 
                           " \nSlope =",signif(fit_amph$coef[[2]], 5), 
                           " \nP =",signif(summary(fit_amph)$coef[2, 4], 5))) +
    ylab("Average mycorrhizal colonisation (% of root)") +
    xlab("Fire frequency (Average Number of Fires / Year") + theme_pubclean() + scale_colour_Publication()
print(p1_amph)
```



```{r plot soil nutrient data}
# change this to be for wider dataset, not just ones I have mycorrhizal data on

#plot soil nitrogen against fire frequency
nit_model <- lm(TotalINmgperg ~ Fire, data = nitrogen)
p1_nit <- ggplot(nitrogen, aes(x=Fire, y=TotalINmgperg)) + 
  geom_point() + 
  stat_smooth(method = "lm") + 
  geom_label(aes(x = 0.5, y = 0.005), hjust = 0, 
             label = paste("Adj R2 = ",signif(summary(nit_model)$adj.r.squared, 5), 
                           "\nIntercept =",signif(nit_model$coef[[1]],5 ), 
                           " \nSlope =",signif(nit_model$coef[[2]], 5), 
                           " \nP =",signif(summary(nit_model)$coef[2, 4], 5))) +
  ylab("Soil Inorganic Nitrogen") +
  xlab("Fire Frequency (Number of Fires / Year)") + theme_pubclean() + scale_colour_Publication()
print(p1_nit)

# plot soil phosphate against fire frequency
phos_model <- lm(soil_phosphate ~ fire_frequency, data = phosphorous)
p1_phos <- ggplot(phosphorous, aes(x=fire_frequency, y=soil_phosphate)) + 
  geom_point() + 
  stat_smooth(method = "lm") + 
  geom_label(aes(x = 0.05, y = 0.06), hjust = 0, 
             label = paste("Adj R2 = ",signif(summary(phos_model)$adj.r.squared, 5), 
                           "\nIntercept =",signif(phos_model$coef[[1]],5 ), 
                           " \nSlope =",signif(phos_model$coef[[2]], 5), 
                           " \nP =",signif(summary(phos_model)$coef[2, 4], 5))) +
  ylab("Soil Phosphate") +
  xlab("Fire Frequency (Number of Fires / Year)") + theme_pubclean() + scale_colour_Publication()
print(p1_phos)
```

```{r plot mycorrhizal colonisation per species}
data_species <- data_combined %>%
  group_by(species) %>%
  summarise(avg_colonisation = mean(mean_colonisation),
            functional_group = first(functional_group))
  
# plot the average mycorrhizal colonisation per species
ggplot(data_species, aes(x=species, y=avg_colonisation, fill = functional_group)) + 
  geom_bar(stat="identity") + 
  xlab("Species") +
  ylab("Average AMF Colonisation (% of Root)") +
  coord_flip() + 
  theme_pubclean() + 
  scale_fill_Publication()
```

```{r plot mycorrhizal colonisation against root traits}
# plot mycorrhizal colonisation against average root diameter
ggplot(data_section_cleaned, aes(x=average_diameter_mm, y=mean_colonisation, color = species)) +
  geom_point() +
  xlab("Average Root Diameter (mm)") +
  ylab("Average AMF Colonisation (%)") + theme_pubclean() + scale_fill_Publication()
# Variation seems to mostly interspecific
```
```{r plot community composition change}
ggplot(data_combined, aes(x = fire_frequency.y, y = relative_cover, fill = species)) +
  geom_bar(position = "dodge", stat = "identity") +
  labs(x = "Fire Frequency", y = "Relative Cover") +
  theme_pubclean() + scale_colour_Publication()
```


```{r principle component analysis}
pca_data_section <- na.omit(data_section_combined)

pca_data_section[] <- lapply(pca_data_section, as.numeric)

pca_data_section$SIN <- pca_data_section$soil_inorganic_nitrogen
pca_data_section$SP <- pca_data_section$mean.soil_phosphate
pca_data_section$AMF <- pca_data_section$mean_colonisation
pca_data_section$FF <- pca_data_section$fire_frequency.y
pca_data_section$LU <- pca_data_section$light_uptake_herb 
pca_data_section$RD <- pca_data_section$average_diameter_mm

vars <- c("RD", "SRL", "RTD", "AMF", "FF", "LU", "SIN", "SP")
# mycorrhizal colonisation and average root diaeter, as well as soil inorganic nitrogen don't contribute to the variance in the data

pca_data_section[, vars] <- scale(pca_data_section[, vars])

pca_section <- PCA(scale(pca_data_section[, vars]), scale.unit = TRUE, ncp = 5, graph = FALSE)

fviz_pca_biplot(pca_section, col.var = "contrib", col.ind = "gray", gradient.cols = c("#386cb0","#7fc97f","#ef3b2c"), 
                repel = TRUE, addEllipses = TRUE, label = "var") + ggplot2::theme(plot.title = "PCA") + theme_pubclean() + scale_fill_Publication()
```

```{r plot root traits against soil nutrients, eval=FALSE, include=FALSE}
nitrogen$site <- nitrogen$Burn.Unit 
root_traits$site <- as.character(root_traits$site)
nutrient_roots <- full_join(root_data, phosphorous_summarised, by = "site")
nutrient_roots <- full_join(nutrient_roots, nitrogen_summarised, by = "site")
nutrient_roots <- na.omit(nutrient_roots)

diameter_nutrients_model <- lm(average_diameter_mm ~ mean.soil_phosphate + mean_inorganic_N + species, data = nutrient_roots)
summary(diameter_nutrients_model)
anova(diameter_nutrients_model)
#no significant effect of nutrients on root diameter

SRL_nutrients_model <- lm(SRL ~ mean.soil_phosphate + mean_inorganic_N + species, data = nutrient_roots)
summary(SRL_nutrients_model)
anova(SRL_nutrients_model)
# soil phosphate is a predictor of SRL

cor.test(nutrient_roots$SRL, nutrient_roots$mean.soil_phosphate)
```
